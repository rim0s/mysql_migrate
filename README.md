```text
       ██████  ▄▄▄       ██▓ ███▄    █ ▄▄▄█████▓
     ▒██    ▒ ▒████▄    ▓██▒ ██ ▀█   █ ▓  ██▒ ▓▒
     ░ ▓██▄   ▒██  ▀█▄  ▒██▒▓██  ▀█ ██▒▒ ▓██░ ▒░
      ▒   ██▒░██▄▄▄▄██ ░██░▓██▒  ▐▌██▒░ ▓██▓ ░ 
    ▒██████▒▒ ▓█   ▓██▒░██░▒██░   ▓██░  ▒██▒ ░ 
     ▒ ▒▓▒ ▒ ░ ▒▒   ▓▒█░░▓  ░ ▒░   ▒ ▒   ▒ ░░   
     ░ ░▒  ░ ░  ▒   ▒▒ ░ ▒ ░░ ░░   ░ ▒░    ░    
     ░  ░  ░    ░   ▒    ▒ ░   ░   ░ ░   ░      
           ░        ░  ░ ░           ░                                                      
```

# MySQL 实例迁移工具

> ⚠️ **注意：这不是一个成熟项目，也未经充分测试，请在充分阅读所有代码并理解后使用。**

## 📖 项目背景

### 问题起源
同事使用 `yum` 安装了发行版默认的 MySQL 8.x 服务，但未自行初始化实例和配置。随着 `/usr/lib/mysql` 文件夹不断增大，系统存储空间告急。

### 解决方案
虽然迁移操作本身不复杂，但在生产环境中执行存在风险。因此借助 AI 辅助编写了这个自动化脚本，解决以下核心问题：
- MySQL 实例数据目录迁移
- 多实例场景处理
- 系统服务配置更新
- SELinux 上下文修复（理论上）

### 开发说明
- 主要脚本由 **DeepSeek AI** 编写，功能相对完整
- 辅助功能通过 **VS Code Copilot Pro** 补充和完善
- 仅在 UOS Server 20 1070A x86-64 下进行简单单实例测试
- SELinux 相关代码未经充分验证

## 📁 文件结构

### 核心文件
- `mysql_migrate.sh` - 主迁移脚本（DeepSeek AI 编写）
- `mysql_attach_instance.sh` - 实例附加脚本（Copilot Pro 编写）

### 资源目录 (RES/)
包含验证系统和辅助脚本：
- `deploy_validation_files.sh` - 部署验证文件脚本
- 各种查询和验证文件
- SHA256 哈希验证文件

## 🚀 快速开始

### 首次使用
```bash
# 1. 进入 RES 目录
cd RES

# 2. 运行部署脚本生成哈希文件
./deploy_validation_files.sh

# 3. 返回上级目录
cd ..

# 4. 给主脚本添加执行权限并运行
chmod +x mysql_migrate.sh
sudo ./mysql_migrate.sh yes
```

### 日常使用
```bash
# 直接运行主脚本，自动加载验证系统
sudo ./mysql_migrate.sh yes
```

### 完整性验证
```bash
# 手动验证文件完整性
cd RES
sha256sum -c mysql_validation_queries.sha256
```

## ⚠️ 重要注意事项

### 环境要求
- **测试环境**：仅在 UOS Server 20 1070A x86-64 测试
- **SELinux**：测试环境为关闭状态，相关代码未经验证
- **MySQL 版本**：针对默认安装的 MySQL 8.x 实例
- **权限要求**：需要 root 权限执行

### 使用前提
1. **充分理解代码**：请仔细阅读所有脚本内容
2. **备份数据**：操作前务必备份重要数据
3. **测试环境验证**：先在测试环境验证功能
4. **目录结构**：保持 RES 目录结构不变

### 已知限制
- 多实例检测可能存在目录识别不准确问题
- 脚本主要针对默认安装的 MySQL 实例
- 未在各种发行版和配置下充分测试

## 🔧 功能特性

### 核心功能
- ✅ MySQL 数据目录迁移
- ✅ 多实例检测与处理
- ✅ systemd 服务配置更新
- ✅ 文件权限和所有权修复
- ✅ 完整性验证系统

### 安全特性
- ✅ 操作前检查和验证
- ✅ 文件完整性哈希验证
- ✅ 用户确认机制
- ✅ 错误处理和回滚提示

## 🤝 贡献与改进

### 当前状态
- 项目处于初步阶段，功能基本完整但测试有限
- 由于个人原因，项目可能无限期暂停更新

### 致谢
- **DeepSeek AI**：主要脚本编写
- **GitHub Copilot**：辅助功能完善
- **开源社区**：提供参考和灵感

## 📄 许可证与声明

### 免责声明
本项目：
- 未经充分测试，生产环境使用需谨慎
- 不提供任何明示或暗示的担保
- 使用者需自行承担所有风险

### 替代方案
在 GitHub 上已有许多成熟的 MySQL 迁移工具，如果您需要生产环境解决方案，建议优先考虑那些经过充分测试和维护的项目。

---

> 💡 **最后提醒**：本工具为解决特定问题而创建，代码质量有限。如果您继续改进和完善它，请务必进行充分测试。感谢所有为此项目贡献想法和代码的朋友。